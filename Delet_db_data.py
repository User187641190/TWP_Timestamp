import sys
from sqlalchemy import text
from database import SessionLocal

def delete_all_data():
    print("‚ö†Ô∏è  WARNING: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Database!")
    print("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà)")
    confirm = input("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡∏û‡∏¥‡∏°‡∏û‡πå 'y' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô): ")

    if confirm.lower() != 'y':
        print("‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        return

    db = SessionLocal()
    try:
        # ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        # üö® ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏π‡∏Å" (‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡∏≤‡∏∞‡πÄ‡∏Ç‡∏≤) -> ‡πÑ‡∏õ‡∏´‡∏≤ "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏°‡πà" (‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å)
        # ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Error: Integrity constraint violated (Foreign Key)
        tables = [
            "Delivery_Time_log",  # ‡∏•‡∏ö Log ‡∏Å‡πà‡∏≠‡∏ô
            "Bill_item",          # ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÉ‡∏ô‡∏ö‡∏¥‡∏•
            "Delivery_bill",      # ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏ö‡∏¥‡∏•
            "Role_permissios",    # ‡∏•‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° Role-Permission (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            "User",               # ‡∏•‡∏ö User (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Employee/Role)
            "Employee",           # ‡∏•‡∏ö Employee
            "Vehicle",            # ‡∏•‡∏ö ‡∏£‡∏ñ
            "Product",            # ‡∏•‡∏ö ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            "Role",               # ‡∏•‡∏ö Role
            "Permission"          # ‡∏•‡∏ö Permission
        ]

        for table in tables:
            try:
                # ‡πÉ‡∏ä‡πâ DELETE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                print(f"üßπ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á: {table}...")
                db.execute(text(f'DELETE FROM "{table}"'))
            except Exception as table_error:
                # ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô
                print(f"   ‚ö†Ô∏è  ‡∏Ç‡πâ‡∏≤‡∏° {table}: {table_error}")

        db.commit()
        print("\n‚úÖ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß! (Database ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÄ‡∏≠‡∏µ‡πà‡∏¢‡∏°)")

    except Exception as e:
        print(f"\n‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á: {e}")
        db.rollback()
    finally:
        db.close()

if __name__ == "__main__":
    delete_all_data()